<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="OpenTalkie.View.ReceiversPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:OpenTalkie.ViewModel"
    Padding="16,16,16,0">
    <AbsoluteLayout>
        <CollectionView
            AbsoluteLayout.LayoutBounds="0,0,1,1"
            AbsoluteLayout.LayoutFlags="All"
            ItemsSource="{Binding Endpoints}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="0,8" BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceVariantLight}, Dark={StaticResource SurfaceVariantDark}}" CornerRadius="8" Shadow="{StaticResource MaterialShadowDark}">
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" RowSpacing="16">
                            <Grid Grid.Row="0" Grid.Column="0" RowDefinitions="*,Auto">
                                <Label Grid.Row="0" FontAttributes="Bold" FontSize="16" Text="{Binding Name}" TextColor="{AppThemeBinding Light={StaticResource OnSurfaceLight}, Dark={StaticResource OnSurfaceDark}}" />
                                <Grid Grid.Row="1" ColumnDefinitions="Auto,Auto">
                                    <Label Grid.Column="0" FontSize="14" Text="{Binding Hostname}" TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariantLight}, Dark={StaticResource OnSurfaceVariantDark}}" />
                                    <Label Grid.Column="1" FontSize="14" Text="{Binding Port, StringFormat=':{0}'}" TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariantLight}, Dark={StaticResource OnSurfaceVariantDark}}" />
                                </Grid>
                            </Grid>
                            <Switch Grid.Column="1" IsToggled="{Binding IsEnabled}" OnColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" ThumbColor="{AppThemeBinding Light={StaticResource OnPrimaryLight}, Dark={StaticResource PrimaryDarkText}}" />
                            <!-- Volume slider -->
                            <Grid Grid.Row="1" Grid.Column="0" ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="10">
                                <Label Text="Vol" TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariantLight}, Dark={StaticResource OnSurfaceVariantDark}}" VerticalOptions="Center"/>
                                <Slider Grid.Column="1" Minimum="0" Maximum="4" Value="{Binding Volume, Mode=TwoWay}"/>
                                <Label Grid.Column="2" Text="{Binding Volume, StringFormat='x{0:F2}'}" TextColor="{AppThemeBinding Light={StaticResource OnSurfaceVariantLight}, Dark={StaticResource OnSurfaceVariantDark}}" VerticalOptions="Center"/>
                            </Grid>
                            <Grid Grid.Row="1" Grid.Column="1" ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="10">
                                <Button Grid.Column="3" Text="Reset" Command="{Binding BindingContext.ResetVolumeCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}" CommandParameter="{Binding}" BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceVariantLight}, Dark={StaticResource SurfaceVariantDark}}" TextColor="{AppThemeBinding Light={StaticResource OnSurfaceLight}, Dark={StaticResource OnSurfaceDark}}"/>
                            </Grid>
                            <HorizontalStackLayout Grid.Row="2" Grid.Column="0" Spacing="10">
                                <Button Padding="16,8"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                        Command="{Binding BindingContext.OpenSettingsCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                        CommandParameter="{Binding}"
                                        CornerRadius="8" FontAttributes="Bold" FontSize="14"
                                        Shadow="{StaticResource MaterialShadowDark}" Text="Open" TextColor="{AppThemeBinding Light={StaticResource OnPrimaryLight}, Dark={StaticResource PrimaryDarkText}}" />
                                <Button Padding="16,8"
                                        BackgroundColor="{AppThemeBinding Light={StaticResource ErrorLight}, Dark={StaticResource ErrorDark}}"
                                        Command="{Binding BindingContext.DeleteStreamCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                        CommandParameter="{Binding}"
                                        CornerRadius="8" FontAttributes="Bold" FontSize="14"
                                        Shadow="{StaticResource MaterialShadowDark}" Text="Delete" TextColor="{AppThemeBinding Light={StaticResource OnErrorLight}, Dark={StaticResource OnErrorDark}}" />
                            </HorizontalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button
            AbsoluteLayout.LayoutBounds="0.95,0.95,AutoSize,AutoSize"
            AbsoluteLayout.LayoutFlags="PositionProportional"
            BackgroundColor="{AppThemeBinding Light={StaticResource SecondaryContainerLight}, Dark={StaticResource SecondaryContainerDark}}"
            Command="{Binding AddStreamCommand}"
            CornerRadius="25"
            FontAttributes="Bold"
            FontSize="24"
            HeightRequest="50"
            Shadow="{StaticResource MaterialShadowDark}"
            Text="+"
            TextColor="{AppThemeBinding Light={StaticResource OnSecondaryLight}, Dark={StaticResource OnSecondaryDark}}"
            WidthRequest="50" />
    </AbsoluteLayout>

    <ContentPage.Resources>
        <Shadow x:Key="MaterialShadowDark" Brush="#80FFFFFF" Opacity="0.2" Radius="4" Offset="0,2" />
    </ContentPage.Resources>
</ContentPage>
